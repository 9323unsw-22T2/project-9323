import * as React from 'react';
import styles from './App.module.css';
import { Button, Box } from '@mui/material';
import Menu from '@mui/material/Menu';
import MenuItem from '@mui/material/MenuItem';
import Fade from '@mui/material/Fade';
import { styled, alpha } from '@mui/material/styles';
import SettingsIcon from '@mui/icons-material/Settings';
import InputBase from '@mui/material/InputBase';
import QuestionMarkIcon from '@mui/icons-material/QuestionMark';
import SearchIcon from '@mui/icons-material/Search';
import WorkspacePremiumIcon from '@mui/icons-material/WorkspacePremium';
import AccountBoxIcon from '@mui/icons-material/AccountBox';
import QuestionAnswerIcon from '@mui/icons-material/QuestionAnswer';
import HelpIcon from '@mui/icons-material/Help';
import LogoutIcon from '@mui/icons-material/Logout';
import { logOut } from '../../service';
import { useNavigate } from 'react-router-dom';

const Search = styled('div')(({ theme }) => ({
  position: 'relative',
  borderRadius: theme.shape.borderRadius,
  backgroundColor: alpha(theme.palette.common.white, 0.15),
  '&:hover': {
    backgroundColor: alpha(theme.palette.common.white, 0.25),
  },
  marginRight: theme.spacing(2),
  marginLeft: 0,
  width: '100%',
  [theme.breakpoints.up('sm')]: {
    marginLeft: theme.spacing(3),
    width: 'auto',
  },
}));

const SearchIconWrapper = styled('div')(({ theme }) => ({
  padding: theme.spacing(0, 2),
  height: '100%',
  position: 'absolute',
  pointerEvents: 'none',
  display: 'flex',
  alignItems: 'center',
  justifyContent: 'center',
}));

const StyledInputBase = styled(InputBase)(({ theme }) => ({
  color: 'inherit',
  '& .MuiInputBase-input': {
    padding: theme.spacing(1, 1, 1, 0),
    // vertical padding + font size from searchIcon
    paddingLeft: `calc(1em + ${theme.spacing(4)})`,
    transition: theme.transitions.create('width'),
    width: '100%',
    [theme.breakpoints.up('md')]: {
      width: '40ch',
    },
    [theme.breakpoints.up('lg')]: {
      width: '50ch',
    },
  },
}));
const Navbar = () => {
  const navigate = useNavigate();

  const [anchorEl, setAnchorEl] = React.useState(null);
  const open = Boolean(anchorEl);
  const handleClick = (event) => {
    setAnchorEl(event.currentTarget);
  };
  const handleClose = (e) => {
    setAnchorEl(null);
  };
  return (
    <div className={styles.Navbar}>
      <div className={styles.logo}>
        <svg
          width="229"
          height="49"
          viewBox="0 0 229 49"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M70.8038 29.699C67.373 29.699 65.5854 28.8596 63.2705 27.0399V15.364C65.5854 13.5823 67.373 12.7483 70.8038 12.7483C74.2347 12.7483 75.3172 13.8043 75.3172 16.2413V26.2059C75.3172 28.605 74.2069 29.699 70.8038 29.699ZM61.5551 40.4055H63.2871V28.3505C65.4133 30.208 67.1732 31.2262 70.8594 31.2262C75.3339 31.2262 77.0493 29.6015 77.0493 26.1301V16.3117C77.0493 12.8566 75.3339 11.2211 70.8594 11.2211C67.1732 11.2211 65.3967 12.2392 63.2871 14.0805V11.3727H61.5717L61.5551 40.4055Z"
            fill="#18B586"
          />
          <path
            d="M81.246 25.4532C81.246 21.5486 82.9669 20.3788 86.4866 19.9781C88.3963 19.756 90.8278 19.5394 94.6861 19.1711V16.3063C94.6861 13.8639 93.5758 12.8024 91.0888 12.8024H87.2749C84.8045 12.8024 83.6775 13.8855 83.6775 16.3063V16.745H81.9566V16.42C81.9566 12.9487 83.6775 11.3077 87.1972 11.3077H91.1665C94.6861 11.3077 96.4071 12.9324 96.4071 16.42V31.042H94.6861V28.2855C92.7042 30.2947 90.8001 31.172 87.2749 31.172C82.9669 31.172 81.246 29.3795 81.246 25.4532ZM94.6861 26.9858V20.4005L86.5643 21.3861C84.0939 21.711 82.9669 22.518 82.9669 25.4748C82.9669 28.4317 84.0772 29.6719 87.3137 29.6719C90.5503 29.6719 92.3656 28.8325 94.6861 27.0075V26.9858Z"
            fill="#18B586"
          />
          <path
            d="M101.687 11.3077H103.408V14.1888C105.467 12.4017 107.26 11.3077 110.031 11.3077H111.341V12.9324H110.031C107.521 12.9324 105.589 13.8855 103.408 15.5644V31.0258H101.687V11.3077Z"
            fill="#18B586"
          />
          <path
            d="M127.623 31.0258L121.022 19.9618L116.531 24.8358V31.0096H114.81V4.36499H116.531V22.7454L126.829 11.3186H128.961L122.16 18.7216L129.572 31.0258H127.623Z"
            fill="#18B586"
          />
          <path
            d="M132.492 4.36499H134.213V13.9722C136.345 12.1092 138.099 11.0857 141.546 11.0857C145.743 11.0857 147.464 12.7104 147.464 16.198V31.0258H145.743V16.1276C145.743 13.7177 144.633 12.6183 141.513 12.6183C138.393 12.6183 136.517 13.4577 134.213 15.2882V31.0258H132.492V4.36499Z"
            fill="#3F4B50"
          />
          <path
            d="M152.288 25.9135V16.42C152.288 12.9487 154.009 11.3077 157.529 11.3077H162.398C165.917 11.3077 167.638 12.9324 167.638 16.42V25.9135C167.638 29.3795 165.917 31.0258 162.398 31.0258H157.529C154.009 31.0258 152.288 29.3795 152.288 25.9135ZM162.32 29.4932C164.829 29.4932 165.917 28.4101 165.917 25.9839V16.3442C165.917 13.9018 164.807 12.8403 162.32 12.8403H157.607C155.136 12.8403 154.009 13.9235 154.009 16.3442V25.9947C154.009 28.4101 155.12 29.504 157.607 29.504L162.32 29.4932Z"
            fill="#3F4B50"
          />
          <path
            d="M172.463 26.0976V11.3077H174.189V26.168C174.189 28.6159 175.3 29.6719 178.453 29.6719C181.606 29.6719 183.394 28.8325 185.714 27.0454V11.3077H187.441V31.0258H185.714V28.318C183.582 30.181 181.861 31.237 178.419 31.237C174.189 31.2424 172.463 29.5636 172.463 26.0976Z"
            fill="#3F4B50"
          />
          <path
            d="M192.864 11.3077H194.585V13.9722C196.723 12.1092 198.471 11.0857 201.924 11.0857C206.116 11.0857 207.837 12.7104 207.837 16.198V31.0258H206.116V16.1276C206.116 13.7177 205.033 12.6183 201.886 12.6183C198.738 12.6183 196.889 13.4577 194.585 15.2882V31.0258H192.864V11.3077Z"
            fill="#3F4B50"
          />
          <path
            d="M212.666 26.0976V16.2467C212.666 12.7754 214.387 11.1344 218.879 11.1344C222.62 11.1344 224.347 12.158 226.479 14.0209V4.36499H228.2V31.0258H226.501V28.318C224.369 30.181 222.642 31.2045 218.901 31.2045C214.387 31.2099 212.666 29.5636 212.666 26.0976ZM226.501 27.0075V15.2882C224.18 13.4956 222.382 12.6562 218.94 12.6562C215.498 12.6562 214.41 13.7393 214.41 16.1601V26.168C214.41 28.578 215.52 29.6719 218.94 29.6719C222.359 29.6719 224.158 28.8325 226.501 27.0075Z"
            fill="#3F4B50"
          />
          <path
            d="M25.1094 2.39596e-06C20.1426 0.00107351 15.2877 1.43875 11.1584 4.13125C7.0291 6.82376 3.81091 10.6502 1.91071 15.1268C0.0105079 19.6033 -0.486384 24.529 0.482859 29.281C1.4521 34.0331 3.84395 38.3981 7.35601 41.8241C10.8681 45.2502 15.3426 47.5835 20.2139 48.529C25.0852 49.4745 30.1345 48.9898 34.7235 47.1361C39.3124 45.2824 43.2349 42.143 45.9949 38.1148C48.755 34.0867 50.2288 29.3506 50.2299 24.5054C50.2314 21.2869 49.5826 18.0997 48.3207 15.1259C47.0588 12.1521 45.2085 9.45012 42.8755 7.1743C40.5426 4.89848 37.7727 3.09347 34.7243 1.86247C31.6759 0.631459 28.4087 -0.00142109 25.1094 2.39596e-06Z"
            fill="#21B685"
          />
          <path
            d="M31.005 35.7103C31.005 35.6669 30.9717 35.6344 30.9717 35.5911L30.5331 34.9521C30.4843 34.9003 30.4566 34.8329 30.4554 34.7625V34.7246L31.0771 27.7656L34.0194 24.8954L34.408 25.307C33.6434 26.166 33.1346 27.213 32.9369 28.3343L32.2485 34.5351V34.6867L32.404 36.6526C32.4073 36.7499 32.4434 36.8434 32.5066 36.9187C32.5698 36.9941 32.6566 37.0471 32.7537 37.0696L33.4088 37.2591C33.4383 37.2629 33.4657 37.2763 33.4865 37.297L34.0416 37.7898C34.0905 37.8416 34.1181 37.909 34.1194 37.9794C34.1202 38.0142 34.1136 38.0488 34.1002 38.081C34.0867 38.1133 34.0666 38.1425 34.0411 38.1669C34.0156 38.1912 33.9853 38.2102 33.9519 38.2227C33.9186 38.2352 33.883 38.2408 33.8473 38.2393L32.1819 38.1689C32.1042 38.1689 32.0653 38.131 32.0265 38.131L31.4713 37.7898C31.4259 37.7703 31.3872 37.7385 31.3596 37.6982C31.3321 37.6579 31.3169 37.6108 31.3159 37.5624L31.005 35.7103Z"
            fill="white"
          />
          <path
            d="M18.7973 24.4404L18.3199 24.9116L18.0479 24.7275L14.5227 29.4498L13.0626 31.4103C13.0226 31.4492 12.9911 31.4957 12.9701 31.5469C12.9491 31.5981 12.939 31.653 12.9405 31.7081L12.674 35.8294C12.7754 35.9784 12.8906 36.118 13.0182 36.2464L13.4457 37.0424C13.4703 37.0832 13.5041 37.118 13.5445 37.1443C13.5848 37.1706 13.6308 37.1876 13.6788 37.1941L14.7891 37.3078C14.9446 37.3078 15.1777 37.1941 15.1777 37.0804C15.1113 36.7953 14.9467 36.5411 14.7114 36.3601L14.1563 36.0243C14.0963 35.9874 14.047 35.9363 14.013 35.8756C13.979 35.815 13.9614 35.7468 13.962 35.6777V35.6344L14.1951 33.6252C14.3014 32.8485 14.5923 32.1067 15.0445 31.459C15.2745 31.1334 15.549 30.84 15.8606 30.5871C17.4967 29.2557 18.5395 27.357 18.7695 25.2907V25.2528C18.7695 25.1011 18.8084 24.7112 18.8084 24.4621"
            fill="white"
          />
          <path
            d="M39.7264 11.6597C39.6496 11.6597 39.5744 11.6375 39.5105 11.5959C39.4466 11.5542 39.3968 11.495 39.3674 11.4257C39.338 11.3565 39.3303 11.2802 39.3453 11.2067C39.3603 11.1332 39.3973 11.0656 39.4516 11.0126C39.506 10.9596 39.5752 10.9235 39.6506 10.9089C39.726 10.8942 39.8041 10.9017 39.8751 10.9304C39.9462 10.9591 40.0068 11.0077 40.0495 11.07C40.0922 11.1324 40.115 11.2057 40.115 11.2807C40.1183 11.3313 40.1105 11.382 40.0921 11.4294C40.0737 11.4768 40.0452 11.5199 40.0084 11.5558C39.9717 11.5916 39.9275 11.6194 39.8789 11.6374C39.8303 11.6553 39.7783 11.6629 39.7264 11.6597ZM44.1066 11.0153V10.8637C44.0684 10.7474 43.9948 10.6452 43.8956 10.5707C43.7965 10.4962 43.6764 10.4529 43.5514 10.4467H43.396L42.0359 10.7878C41.6995 10.8856 41.3414 10.8866 41.0046 10.7905C40.6678 10.6944 40.3666 10.5054 40.1372 10.2463C40.0595 10.1705 39.9818 10.0567 39.9041 10.0188C39.8264 9.98092 39.8708 9.98092 39.8319 9.98092C39.793 9.98092 39.793 9.94301 39.7486 9.94301C39.7042 9.94301 39.7153 9.9051 39.6709 9.9051H39.6376C39.5987 9.9051 39.5987 9.9051 39.5599 9.86719H39.2879C39.1955 9.86109 39.1028 9.87401 39.0158 9.9051L37.195 10.2571L36.34 10.4467C36.071 10.5161 35.8366 10.6776 35.6794 10.9016L33.5476 13.9993L33.2034 14.4921C32.7435 15.1637 32.1197 15.7132 31.3881 16.0913C30.6564 16.4694 29.84 16.6643 29.0121 16.6583C28.5172 16.6505 28.0232 16.7014 27.5409 16.8099H27.4798L20.6182 18.2017L16.8598 18.9545C16.2083 19.0747 15.5875 19.3195 15.0334 19.6748C13.8695 20.2965 12.5632 20.6207 11.2362 20.6171C9.5077 20.6001 7.82749 20.0588 6.42859 19.0682C6.41321 19.0539 6.39479 19.0431 6.37464 19.0366C6.35449 19.03 6.3331 19.0279 6.31201 19.0303C6.28629 19.0286 6.26051 19.0324 6.23645 19.0414C6.21238 19.0504 6.19062 19.0644 6.17266 19.0825C6.1547 19.1005 6.14098 19.1221 6.13245 19.1459C6.12392 19.1696 6.12078 19.1948 6.12326 19.2199C6.12301 19.2488 6.12935 19.2774 6.14183 19.3036C6.15432 19.3298 6.17262 19.353 6.19543 19.3715C6.94246 20.1332 7.83926 20.7402 8.83221 21.1561C9.82517 21.5721 10.8939 21.7884 11.9745 21.7923H12.402C12.5904 22.5473 12.6818 23.3222 12.674 24.0993C12.6775 26.493 11.8121 28.8105 10.2314 30.6413C9.68024 31.2529 9.06844 31.8098 8.40492 32.3039C8.31589 32.3823 8.26039 32.4906 8.24948 32.6071L7.51668 37.7519V37.7844C7.51001 37.8396 7.52379 37.8953 7.55554 37.9415L7.98301 38.6942C8.02814 38.7628 8.09415 38.8158 8.17176 38.8459L8.94897 39.0354C9.01184 39.056 9.07712 39.0687 9.14327 39.0733C9.21059 39.0834 9.27942 39.07 9.33757 39.0354L10.0371 38.808C10.0766 38.7916 10.1112 38.7656 10.1375 38.7324C10.1638 38.6992 10.1808 38.6599 10.1869 38.6184V38.5426L9.88162 37.7844C9.8373 37.696 9.77177 37.6193 9.69059 37.5608C9.60941 37.5024 9.51497 37.4639 9.41529 37.4486C9.41529 37.2591 9.37643 37.0696 9.37643 36.88C9.38058 35.5302 9.76158 34.207 10.4785 33.0525C11.1954 31.898 12.2212 30.9558 13.4457 30.3272C14.6006 29.7891 15.5356 28.8865 16.0993 27.7656C16.519 26.9051 17.1818 26.1793 18.0099 25.6738C18.838 25.1682 19.7968 24.9038 20.7736 24.9116C21.7994 24.9025 22.8026 25.2053 23.6438 25.7781C24.8407 26.6796 26.2827 27.2182 27.7907 27.327H27.8296C27.9842 27.3394 28.128 27.4092 28.2313 27.5221C28.3346 27.635 28.3895 27.7823 28.3847 27.9335V27.9714L27.8296 36.2139V36.2518C27.8441 36.3921 27.9051 36.524 28.0032 36.6276C28.1014 36.7311 28.2314 36.8007 28.3736 36.8259C28.4585 36.8678 28.5334 36.9265 28.5937 36.9983C28.6539 37.0701 28.6981 37.1534 28.7234 37.2429L29.1841 39.4091C29.1987 39.5479 29.2619 39.6775 29.363 39.7761C29.4641 39.8748 29.597 39.9364 29.7393 39.9506L30.6331 40.0265H30.7108L31.9877 39.7232C32.0654 39.6853 32.182 39.6474 32.182 39.5336C32.182 39.2683 31.4825 38.7755 31.4825 38.7755C31.4232 38.7293 31.3578 38.691 31.2882 38.6617L30.8218 38.548C30.7078 38.5136 30.6052 38.4504 30.5242 38.3648C30.4433 38.2792 30.387 38.1742 30.3611 38.0606L29.978 36.3872V36.2843L30.8718 29.2874C30.8974 29.1057 30.9787 28.9358 31.105 28.8L35.0576 24.6029H35.0188C35.534 24.0363 35.9133 23.3647 36.1291 22.6371L37.3337 17.7631C37.5702 16.8911 38.065 16.1065 38.7562 15.5073C39.4474 14.9082 40.3043 14.5211 41.2198 14.3946C42.0125 14.2309 42.7244 13.8085 43.2381 13.1972C43.7518 12.5858 44.0366 11.822 44.0455 11.0315"
            fill="white"
          />
          <path
            d="M39.5823 11.8546C39.8643 11.8546 40.093 11.6316 40.093 11.3564C40.093 11.0812 39.8643 10.8582 39.5823 10.8582C39.3002 10.8582 39.0715 11.0812 39.0715 11.3564C39.0715 11.6316 39.3002 11.8546 39.5823 11.8546Z"
            fill="#21B685"
          />
        </svg>
      </div>
      <Search sx={{
        display: 'flex',
        margin: 'auto',
        height: 'max-content',
        '@media screen and (max-width:1000px)': {
          display: 'none'
        }
      }}>
        <SearchIconWrapper>
          <SearchIcon />
        </SearchIconWrapper>
        <StyledInputBase
          sx={{ backgroundColor: 'rgba(0, 0, 0, 0.04)', borderRadius: '1rem' }}
          placeholder="Search…"
          inputProps={{ 'aria-label': 'search' }}
        />
        <Box sx={{ margin: 'auto' }}>
          <Button
            xs={{ margin: 'auto !important', borderRadius: '1rem' }}
            variant="contained"
          >
            Search
          </Button>
        </Box>
      </Search>
      <Box sx={{ marginLeft: 'auto', mr: 2, textAlign: 'center' }}>
        <Button
          variant="standard"
          className={`${styles.loginbutton} `}
          sx={{ fontSize: '18px' }}
          onMouseOver={handleClick}
        >
          My account
        </Button>
        <Menu
          MenuListProps={{
            'aria-labelledby': 'fade-button',
          }}
          anchorEl={anchorEl}
          open={open}
          onClose={handleClose}
          TransitionComponent={Fade}
        >
          <MenuItem
            sx={{ width: '10rem', fontSize: '1.2rem' }}
            onClick={(e) => {
              e.preventDefault()
              navigate('/profile')
            }}
          >
            <AccountBoxIcon></AccountBoxIcon>
            Profile
          </MenuItem>
          <MenuItem sx={{ fontSize: '1.2rem' }} onClick={handleClose}>
            <QuestionAnswerIcon></QuestionAnswerIcon>
            My answer
          </MenuItem>
          <MenuItem sx={{ fontSize: '1.2rem' }} onClick={handleClose}>
            <QuestionMarkIcon></QuestionMarkIcon>
            My question
          </MenuItem>
          <MenuItem sx={{ fontSize: '1.2rem' }} onClick={handleClose}>
            <WorkspacePremiumIcon></WorkspacePremiumIcon>
            Expert
          </MenuItem>
          <MenuItem sx={{ fontSize: '1.2rem' }} onClick={handleClose}>
            <SettingsIcon></SettingsIcon>
            Setting
          </MenuItem>
          <MenuItem sx={{ fontSize: '1.2rem' }} onClick={(e) => {
            e.preventDefault()
            navigate('/help')
          }}>
            <HelpIcon></HelpIcon>
            Help
          </MenuItem>
          <MenuItem sx={{ fontSize: '1.2rem' }} onClick={async (e) => {
            e.preventDefault()
            try {
              await logOut({});
              localStorage.removeItem('token')
              window.location.reload(false);
            } catch (error) {
              window.alert('Fail to logout, please check network')
            }
            handleClose()
          }}>
            <LogoutIcon></LogoutIcon>
            Logout
          </MenuItem>
        </Menu>
        <Button
          variant="standard"
          className={`${styles.loginbutton} `}
          sx={{ fontSize: '18px' }}
          onClick={(e) => {
            e.preventDefault()
            navigate('/newquestion')
          }}
        >
          Ask question
        </Button>
        <Button
          variant="standard"
          className={`${styles.loginbutton} `}
          sx={{ fontSize: '18px' }}
          onClick={(e) => {
            e.preventDefault()
            navigate('/newguide')
          }}
        >
          Create Guide
        </Button>
      </Box>
    </div>
  );
};
export default Navbar;
